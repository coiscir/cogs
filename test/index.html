<html>
<head>
  <title>Cogs - Tests</title>
  <style type="text/css">
    pre {
      font-size: 8pt;
    }
    
    .pass {
      color: #0a0;
    }
    .fail {
      color: #f00;
    }
  </style>
</head>
<body>

<div style="display: none;" id="serialize_test">
  <form id="serialize" action="" method="get">
    <input type="text" name="text" value="">
    
    <input type="checkbox" name="checkbox" value="foo" checked>
    <input type="checkbox" name="checkbox" value="bar" checked>
    <input type="checkbox" name="checkbox" value="red">
    
    <input type="radio" name="radio" value="foo" checked>
    <input type="radio" name="radio" value="bar">
    <input type="radio" name="radio" value="red">
    
    <select name="select-s">
      <option value="foo" selected>foo</option>
      <option value="bar">bar</option>
      <option value="red">red</option>
    </select>
    <select name="select-m" multiple>
      <option value="foo" selected>foo</option>
      <option value="bar" selected>bar</option>
      <option value="red">red</option>
    </select>
    
    <textarea name="textarea"></textarea>
    
    <input type="button" value="Press">
    <input type="button" name="disabled" value="Enable" disabled>
    
    <input type="submit" value="Go">
  </form>
</div>

<script type="text/javascript" src="../lib/cogs.js"></script>
<script type="text/javascript">
var pass = '<span class="pass">PASS</span>';
var fail = '<span class="fail">FAIL</span>';

var passfail = function (expect, trial, comment) {
  var result;
  try {
    result = trial();
  } catch (e) {
    result = e;
    if (expect === Error)
      comment += ' {Error: ' + e.message + '}';
  }
  var passed = (result === expect || Cogs.is_a(result, expect));
  return (passed ? pass : fail) + ': ' + comment + (passed ? '' : ' {' + result + ' (' + Cogs.type(result) + ')}');
};
</script>
<script type="text/javascript">
function println() {
  for (var i = 0; i < arguments.length; i += 1)
    document.write(arguments[i]);
  document.write('&nbsp;<br />');
}
</script>
<script type="text/javascript">
document.write('<pre>');

var timeStart = new Date().getTime();

println();
println('====  Cogs');
println();
println(passfail(true, function(){ return !!(Cogs && $C); }, 'Build'));
println();
println();
println('====  Cookie');
println();
println('    # Cookies may be disabled with file:// protocol.');
println();
println(passfail(Error, function(){ return Cogs.cookie(); }, 'cookie: invalid arguments'));
println();
println(passfail(true,  function(){ return Cogs.cookie('foo', 'nil'); },                'cookie: write: foo'));
println(passfail(true,  function(){ return Cogs.cookie('bar', '   ', {duration: 2}); }, 'cookie: write: bar (with duration=+2)'));
println(passfail(Error, function(){ return Cogs.cookie('nil', '', {duration: -1}); },   'cookie: write: nil (with duration=-1) (error)'));
println();
println('document.cookie: ', document.cookie);
println();
println(passfail('nil', function(){ return Cogs.cookie('foo'); }, 'cookie: read: foo'));
println(passfail('   ', function(){ return Cogs.cookie('bar'); }, 'cookie: read: bar'));
println(passfail(Error, function(){ return Cogs.cookie('nil'); }, 'cookie: read: nil (error)'));
println();
println(passfail(true,  function(){ return Cogs.cookie('foo', '', true); }, 'cookie: expire: foo'));
println(passfail(true,  function(){ return Cogs.cookie('bar', '', true); }, 'cookie: expire: bar'));
println(passfail(Error, function(){ return Cogs.cookie('nil', '', true); }, 'cookie: expire: nil (Error)'));
println();
println('document.cookie: ', document.cookie);
println();
println(passfail(Error, function(){ return Cogs.cookie('foo'); }, 'cookie: read: foo (error)'));
println(passfail(Error, function(){ return Cogs.cookie('bar'); }, 'cookie: read: bar (error)'));
println(passfail(Error, function(){ return Cogs.cookie('nil'); }, 'cookie: read: nil (error)'));
println();
println();
println('==== Query');
println();
println(passfail(Error,       function(){ return Cogs.query(); },                                     'query: error: invalid argument'));
println(passfail('',          function(){ return Cogs.query('foo').join(','); },                      'query: search address (fails with "?foo=bar")'));
println(passfail('bar',       function(){ return Cogs.query('foo', 'foo=bar').join(','); },           'query: search String'));
println(passfail("b,a,r,',d", function(){ return Cogs.query('t', "t=b&t=a&t=r&t='&t=d").join(','); }, 'query: lists'));
var query_decoded = "+!\"#$%&'()*+,-./:;<=>?@[]^_`{|}~";
var query_encoded = "t=%2B!%22%23%24%25%26'()*%2B%2C-.%2F%3A%3B%3C%3D%3E%3F%40%5B%5D%5E_%60%7B%7C%7D~";
println(passfail(query_decoded, function(){ return Cogs.query('t', query_encoded)[0]; }, 'query: decoding'));
println();
println(passfail('text=&checkbox=foo&checkbox=bar&radio=foo&select-s=foo&select-m=foo&select-m=bar&textarea=', function(){ return Cogs.serialize(document.getElementById('serialize')); }, 'serialize'));
println();
println();
println('====  Time');
println();
println(passfail(Number,      function(){ return Cogs.time(); }, 'time: current'), ' (', Cogs.time(), ')');
println(passfail(Cogs.time(), function(){ return Cogs.utc(); },  'time == utc (no arguments) (may fail)'));
println();
println(passfail(-62135596800000, function(){ return Cogs.utc(   0,  1,  1); },                  'utc: 0001-01-01T00:00:00Z'));
println(passfail(253402300799000, function(){ return Cogs.utc(9999, 12, 31, 23, 59, 59); },      'utc: 9999-12-31T23:59:59Z'));
println(passfail(253402300799999, function(){ return Cogs.utc(9999, 12, 31, 23, 59, 59, 999); }, 'utc: 9999-12-31T23:59:59.999Z'));
println(passfail(-61850893799919, function(){ return Cogs.utc(  10,  1,  9,  4, 10,  0,  81); }, 'utc: 0010-01-09T04:10:00.081Z'));
println();
println(passfail('0001-01-01T00:00:00', function(){ return Cogs.phpdate('Y-m-d\\TH:i:s', Cogs.time(1, 1, 1, 0, 0, 0, 0)); },      'phpdate: time: 0001-01-01T00:00:00'));
println(passfail('9999-12-31T23:59:59', function(){ return Cogs.phpdate('Y-m-d\\TH:i:s', Cogs.time(9999, 12, 31, 23, 59, 59)); }, 'phpdate: time: 9999-12-31T23:59:59'));
println(passfail('0001-01-01T00:00:00', function(){ return Cogs.phputc('Y-m-d\\TH:i:s', Cogs.utc(1, 1, 1, 0, 0, 0, 0)); },        'phputc:  utc:  0001-01-01T00:00:00'));
println(passfail('9999-12-31T23:59:59', function(){ return Cogs.phputc('Y-m-d\\TH:i:s', Cogs.utc(9999, 12, 31, 23, 59, 59)); },   'phputc:  utc:  9999-12-31T23:59:59'));
println();
println(passfail('2008-12-31T12:30:59+00:00',       function(){ return Cogs.phputc('c', Cogs.utc(2008, 12, 31, 12, 30, 59, 000)); }, 'phputc: c'));
println(passfail('Wed, 31 Dec 2008 12:30:59 +0000', function(){ return Cogs.phputc('r', Cogs.utc(2008, 12, 31, 12, 30, 59, 000)); }, 'phputc: r'));
println();
println(passfail(String, function(){ return Cogs.phpdate('c'); }, 'phpdate: current'), ' (c: ', Cogs.phpdate('c'), ')');
println(passfail(String, function(){ return Cogs.phpdate('r'); }, 'phpdate: current'), ' (r: ', Cogs.phpdate('r'), ')');
println(passfail(String, function(){ return Cogs.phputc('r'); },  'phputc:  current'), ' (r: ', Cogs.phputc('r'), ')');
println();
println(passfail('0001-01-01T00:00:00', function(){ return Cogs.strftime('%FT%T', Cogs.time(1, 1, 1, 0, 0, 0, 0)); },      'strftime: time: 0001-01-01T00:00:00'));
println(passfail('9999-12-31T23:59:59', function(){ return Cogs.strftime('%FT%T', Cogs.time(9999, 12, 31, 23, 59, 59)); }, 'strftime: time: 9999-12-31T23:59:59'));
println(passfail('0001-01-01T00:00:00', function(){ return Cogs.strfutc('%FT%T', Cogs.utc(1, 1, 1, 0, 0, 0, 0)); },        'strfutc:  utc:  0001-01-01T00:00:00'));
println(passfail('9999-12-31T23:59:59', function(){ return Cogs.strfutc('%FT%T', Cogs.utc(9999, 12, 31, 23, 59, 59)); },   'strfutc:  utc:  9999-12-31T23:59:59'));
println();
println(passfail('Wed, 31 Dec 2008 12:30:59 GMT', function(){ return Cogs.strfutc('%c', Cogs.utc(2008, 12, 31, 12, 30, 59)); }, 'strfutc: %c'));
println();
println(passfail(String, function(){ return Cogs.strftime('%c'); }, 'strftime: current'), ' (%c: ', Cogs.strftime('%c'), ')');
println(passfail(String, function(){ return Cogs.strfutc('%c'); },  'strfutc:  current'), ' (%c: ', Cogs.strfutc('%c'), ')');
println(passfail(String, function(){ return Cogs.strfutc('%x'); },  'strfutc:  current'), ' (%x: ', Cogs.strfutc('%x'), ')');
println(passfail(String, function(){ return Cogs.strfutc('%X'); },  'strfutc:  current'), ' (%X: ', Cogs.strfutc('%X'), ')');
println();
println(passfail(Error, function(){ return Cogs.strfutc('%c', Cogs.utc(0) - 1); }, 'strfutc: out of range (error)'));
println();
println();
println('====  Type');
println();
println(passfail('undefined', function(){ return Cogs.type(undefined); },         'type: undefined'));
println(passfail('null',      function(){ return Cogs.type(null); },              'type: null'));
println(passfail('array',     function(){ return Cogs.type([]); },                'type: array'));
println(passfail('boolean',   function(){ return Cogs.type(true); },              'type: boolean'));
println(passfail('date',      function(){ return Cogs.type(new Date()); },        'type: date'));
println(passfail('error',     function(){ return Cogs.type(new Error()); },       'type: error'));
println(passfail('error',     function(){ return Cogs.type(new TypeError()); },   'type: error: TypeError'));
println(passfail('error',     function(){ return Cogs.type(new SyntaxError()); }, 'type: error: SyntaxError'));
println(passfail('function',  function(){ return Cogs.type(function(){}); },      'type: function'));
println(passfail('number',    function(){ return Cogs.type(0); },                 'type: number'));
println(passfail('object',    function(){ return Cogs.type({}); },                'type: object'));
println(passfail('regexp',    function(){ return Cogs.type(/./); },               'type: regexp'));
println(passfail('string',    function(){ return Cogs.type(''); },                'type: string'));
println();
println(passfail(true, function(){ return Cogs.is_a(undefined, 'undefined'); }, 'is_a: undefined type'));
println(passfail(true, function(){ return Cogs.is_a(undefined, undefined); },   'is_a: undefined primitive'));
println(passfail(true, function(){ return Cogs.is_a(null, 'null'); },           'is_a: null type'));
println(passfail(true, function(){ return Cogs.is_a(null, null); },             'is_a: null primitive'));
println(passfail(true, function(){ return Cogs.is_a(true, Boolean); },          'is_a: Boolean primitive vs. class'));
println(passfail(true, function(){ return Cogs.is_a(0, 'number'); },            'is_a: Number  primitive vs. type'));
println(passfail(true, function(){ return Cogs.is_a(new String(), 'string'); }, 'is_a: String  object    vs. type'));
println();
println();
println('====  Runtime: ', new Date().getTime() - timeStart, 'ms');
println();

document.write('</pre>');
</script>

</body>
</html>
